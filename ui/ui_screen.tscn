[gd_scene load_steps=12 format=3 uid="uid://c5n3bedy7lusb"]

[ext_resource type="Texture2D" uid="uid://bmjed33p5xihg" path="res://art/UI-HUD Assets/Clock/1000_ Export/Clock (Layer 2).png" id="2_0jwbi"]
[ext_resource type="Theme" uid="uid://b02a2u15epnu7" path="res://ui/ui_theme.tres" id="2_qfcyb"]
[ext_resource type="Texture2D" uid="uid://dr48k2yqo1y3r" path="res://art/Raccoon Assets/Protagonist Raccoon/Idle/Draft #1/Raccoon_Idle2.png" id="2_w3pde"]
[ext_resource type="Texture2D" uid="uid://cdqgnddkpqcg6" path="res://art/UI-HUD Assets/Clock/1000_ Export/Clock (Layer 1).png" id="3_5h3dt"]

[sub_resource type="GDScript" id="GDScript_bvqy0"]
script/source = "extends CanvasLayer

@export var text = \"\"
@export var level_time = 120

var level_score = 0

func _ready():
	$MarginContainer/VBoxContainer/Control/Label.text = text
	level_score = GameManager.level_score[GameManager.current_level-1]
	print(level_score)
	$MarginContainer/VBoxContainer/HBoxContainer/Control/CollectableAmount.text = str(level_score)
	
	$LevelTimer.wait_time = level_time
	$AnimationPlayer.set_speed_scale(1.0/level_time)
	$AnimationPlayer.play(\"pass_time\")
	$LevelTimer.start()

func _on_pause_button_pressed():
	GameManager.pause_game(0)

#TODO attach a signal from collectible object
func _on_collectible_gathered():
	level_score += 1
	$MarginContainer/VBoxContainer/HBoxContainer/CollectableAmount.text = str(level_score)


func _on_level_timer_timeout():
	GameManager.pause_game(1)
"

[sub_resource type="InputEventAction" id="InputEventAction_umm2v"]
action = &"pause_game"

[sub_resource type="Shortcut" id="Shortcut_6f1m4"]
events = [SubResource("InputEventAction_umm2v")]

[sub_resource type="SpriteFrames" id="SpriteFrames_0di5y"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": ExtResource("2_0jwbi")
}],
"loop": true,
"name": &"pass_time",
"speed": 5.0
}]

[sub_resource type="Animation" id="Animation_2p0yj"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("ClockFace:rotation")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [0.0]
}

[sub_resource type="Animation" id="Animation_jekf4"]
resource_name = "pass_time"
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("ClockFace:rotation")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.5, 1),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 0,
"values": [0.0, 3.14159, 6.28319]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_fx3eu"]
_data = {
"RESET": SubResource("Animation_2p0yj"),
"pass_time": SubResource("Animation_jekf4")
}

[node name="UIScreen" type="CanvasLayer"]
script = SubResource("GDScript_bvqy0")

[node name="PauseButton" type="Button" parent="."]
offset_left = 20.0
offset_top = -72.0
offset_right = 138.0
offset_bottom = -15.0
theme = ExtResource("2_qfcyb")
shortcut = SubResource("Shortcut_6f1m4")
shortcut_in_tooltip = false
text = "PAUSE"

[node name="MarginContainer" type="MarginContainer" parent="."]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
theme_override_constants/margin_left = 10
theme_override_constants/margin_top = 10
theme_override_constants/margin_right = 10
theme_override_constants/margin_bottom = 10

[node name="VBoxContainer" type="VBoxContainer" parent="MarginContainer"]
layout_mode = 2

[node name="Control" type="Control" parent="MarginContainer/VBoxContainer"]
layout_mode = 2
size_flags_horizontal = 4

[node name="Label" type="Label" parent="MarginContainer/VBoxContainer/Control"]
layout_mode = 1
offset_left = -170.0
offset_top = 10.0
offset_right = 164.0
offset_bottom = 79.0
theme = ExtResource("2_qfcyb")
text = "UI GOES HERE"
horizontal_alignment = 1

[node name="Control2" type="Control" parent="MarginContainer/VBoxContainer"]
layout_mode = 2
size_flags_horizontal = 8

[node name="ClockFace" type="AnimatedSprite2D" parent="MarginContainer/VBoxContainer/Control2"]
position = Vector2(-49.5, 40.5)
scale = Vector2(0.5, 0.5)
sprite_frames = SubResource("SpriteFrames_0di5y")
animation = &"pass_time"

[node name="ClockBorder" type="Sprite2D" parent="MarginContainer/VBoxContainer/Control2"]
position = Vector2(-49.5, 40.5)
scale = Vector2(0.5, 0.5)
texture = ExtResource("3_5h3dt")

[node name="HBoxContainer" type="HBoxContainer" parent="MarginContainer/VBoxContainer"]
layout_mode = 2

[node name="Control" type="Control" parent="MarginContainer/VBoxContainer/HBoxContainer"]
custom_minimum_size = Vector2(80, 80)
layout_mode = 2

[node name="CollectableSprite" type="Sprite2D" parent="MarginContainer/VBoxContainer/HBoxContainer/Control"]
scale = Vector2(0.25, 0.25)
texture = ExtResource("2_w3pde")
centered = false

[node name="CollectableAmount" type="Label" parent="MarginContainer/VBoxContainer/HBoxContainer/Control"]
layout_mode = 2
offset_left = 84.0
offset_right = 113.0
offset_bottom = 69.0
size_flags_horizontal = 0
size_flags_vertical = 0
theme = ExtResource("2_qfcyb")
text = "0
"

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
root_node = NodePath("../MarginContainer/VBoxContainer/Control2")
libraries = {
"": SubResource("AnimationLibrary_fx3eu")
}

[node name="LevelTimer" type="Timer" parent="."]
one_shot = true

[connection signal="pressed" from="PauseButton" to="." method="_on_pause_button_pressed"]
[connection signal="timeout" from="LevelTimer" to="." method="_on_level_timer_timeout"]
